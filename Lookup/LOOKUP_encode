### vim:ft=zsh:foldmethod=marker
## url encoding for lookup queries, etc.

emulate -L zsh
setopt extendedglob
local input
local -A opts

zparseopts -A opts -D s
for opt in ${(k)opts} ; do
    [[ -z ${opts[$opt]} ]] && opts[$opt]='yes'
done

if [[ ${opts[-s]} == 'yes' ]] ; then
    local ws=$'\t '
    input=${${1##[$ws]#}%%[$ws]#}
    input=${input//[$ws]##/+}
else
    input="$1"
fi

input=( ${(s::)input} )
printf '%s' ${(j::)input/(#b)([^A-Za-z0-9_.!~*\'\(\)+-])/%${(l:2::0:)$(([##16]#match))}}
